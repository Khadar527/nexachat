<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexachat</title>
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
 	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .container {
            display: flex;
            flex-direction: row;
            box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;
        }
        .sidebar {
            width: 250px;
            background-color: white;
            padding: 20px;
            box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px; 
            font-family: poppins;
            border-radius: 10px;
        }
        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }
        .sidebar ul li {
            cursor: pointer;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        .sidebar ul li img {
            width: 30px;
            height: auto;
            margin-right: 10px;
        }
        .main-chat {
            flex: 1;
            padding: 20px;
            
        }
        .main-chat .navbar{
            background-color: #50C878;
            
            color: white;
            
        }
        .main-chat h2{
            padding: 8px;
            padding-left: 20px;
        }
        .chat-window {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
        .chat-input {
            display: flex;
            align-items: center;
        }
        .chat-input input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-right: 10px;
        }
        .chat-input button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        .chat-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            height: 400px;
            overflow-y: auto;
            font-family: Poppins;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .client-message {
            background-color: #bef7dd;
            margin-left: auto;
            text-align: right;
        }
        .server-message {
            background-color: hsl(220deg 100% 80%);
            margin-right: auto;
            text-align: left;
        }
        .chat-container::-webkit-scrollbar {
            display: none;
        }
        .chat-container {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .chat-window::-webkit-scrollbar {
  display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
.chat-window {
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}
 @media only screen and (max-width: 450px) {
      .sidebar {
        width: 45px;
        padding: 5px;
        padding-top: 20px;
        color: white;
      }
      .sidebar:hover {
        color: white;
      }
    }

    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  
    <div class="container">
    <div class="sidebar">
        <ul id="chat-list">
            <li onclick="sendCompany('Google')" data-company="Google"><img src="https://tse2.mm.bing.net/th?id=OIP.D6P-BO32wCApcPIIjt6p5wAAAA&pid=Api&P=0&h=180" alt="Google"> Google</li>
            <li onclick="sendCompany('Amazon')" data-company="Amazon"><img src="https://i.pinimg.com/originals/01/ca/da/01cada77a0a7d326d85b7969fe26a728.jpg" alt="Amazon"> Amazon</li>
            <li onclick="sendCompany('Microsoft')" data-company="Microsoft"><img src="https://tse2.mm.bing.net/th?id=OIP.PWoq1WvDQDxc_MPv4Jt0GwHaHa&pid=Api&P=0&h=180" alt="Microsoft"> Microsoft</li>
            <li onclick="sendCompany('Infosys')" data-company="Infosys"><img src="https://tse1.mm.bing.net/th?id=OIP.-MPawjkpCD-ND1vNxcQl3QAAAA&pid=Api&P=0&h=180" alt="Infosys"> Infosys</li>
            <li onclick="sendCompany('TCS')" data-company="TCS"><img src="https://uploads-ssl.webflow.com/638aec50b9a23cec17b8c4d1/63f74ccf9302c375c409e5b0_TCS.NS-7401f1bd.png" alt="TCS"> TCS</li>
            <li onclick="sendCompany('Wipro')" data-company="Wipro"><img src="https://tse2.mm.bing.net/th?id=OIP.PofDUH-CzGPSqkqdx-HQNwHaEK&pid=Api&P=0&h=180" alt="Wipro"> Wipro</li>
            <li onclick="sendCompany('Accenture')" data-company="Accenture"><img src="https://logos-marcas.com/wp-content/uploads/2020/07/Accenture-Emblema.jpg" alt="Accenture"> Accenture</li>
            <li onclick="sendCompany('Mphasis')" data-company="Mphasis"><img src="https://companieslogo.com/img/orig/MPHASIS.NS-71626325.png?t=1612568622&download=true" alt="Mphasis"> Mphasis</li>
            <li onclick="sendCompany('Redington')" data-company="Redington"><img src="https://companieslogo.com/img/orig/REDINGTON.NS-6aa74494.png?t=1604053079" alt="Redington"> Redington</li>
            <li onclick="sendCompany('Tech Mahindra')" data-company="Tech Mahindra"><img src="https://download.logo.wine/logo/Tech_Mahindra/Tech_Mahindra-Logo.wine.png" alt="Tech Mahindra"> Tech Mahindra</li>
        </ul>
        <button type="button" class="btn btn-primary" style="box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;float: right;">+</button>

    </div>
    
    <div class="main-chat">
        <div class="navbar">
            <h2 id="chat-company-name" style="font-family: poppins;">Select a Company</h2>
        </div>
        <div class="chat-window" id="chat-window">
           
            <!-- Chat messages will appear here -->
            <!--<p id="response"></p>  -->
           <!-- <img style="width: 60%;height: 60%;" src="https://cdn.dribbble.com/users/2479503/screenshots/6933757/media/0e413bb3f571b23ffd9b12fb6366ed53.png?resize=400x0">
        -->
        </div>
        <div class="chat-input">
            
        <input type="text" id="inputMessage" placeholder="Send a message...">
        <!--<div class="chat-container" id="chatHistory"></div>-->
        <div id="chatsend"></div>
        <p id="companynames" style="display: none;"></p>
        </div>
    </div>
    
    </div>
    <!--<h1>Client Chat</h1>
    <div class="chat-container" id="chatHistory"></div>
    <ul><li onclick="sendCompany('Google')">Google</li><li onclick="sendCompany('Amazon')">Amazon</li></ul>
    <input type="text" id="inputMessage" placeholder="Enter a message">
    <button onclick="sendMessage('Google')">Send</button>-
    <div id="chatsend"></div>-->
    <script>
       // var does;
       var user = localStorage.getItem("name");
       
        function sendCompany(company){
            //alert(company);
            var sendButton = `<button type="submit" class="btn btn-success" onclick="sendMessage('${company}')" id="send-button">Send</button>`;
            document.getElementById('chatsend').innerHTML = sendButton;
            document.getElementById('companynames').innerHTML = company;
            document.getElementById('chat-company-name').innerHTML = company;
            //does = company;
           // alert(does);
           fetchMessages(company);
           
        }

        var elem = document.getElementById('companynames').innerHTML;
        function sendMessage(receiver) {
			if(user==null || user==''){
				alert("Please do login");
				var text;
				if (confirm("Page is redirecting to Login page")) {
				   window.location.href = "Login.html"
				} else {
				    text = "You pressed Cancel!";
				  }
				  
			}
			   else{ const inputMessage = document.getElementById('inputMessage').value;
			  fetch('https://nexachat.azurewebsites.net/NewChatProcess/chat', {
			        method: 'POST',
			        headers: {
			            'Content-Type': 'application/json'
			        },
			        body: JSON.stringify({ "message" : inputMessage, "sender": user, "receiver":receiver, })
			    })
			    .then(response => response.text())
			    .then(data => {
			        fetchMessages(receiver); // Fetch messages after sending
			        document.getElementById('inputMessage').value = '';
			    })
			    .catch(error => console.error('Error:', error));
			 }
		}

	        function fetchMessages(company) {
		    fetch(`https://nexachat.azurewebsites.net/NewChatProcess/chat?sender=${user}&receiver=${company}`)
		        .then(response => response.text())
		        .then(data => {
		            updateChatHistory(data);
		        })
		        .catch(error => console.error('Error:', error));
			}

        function updateChatHistory(data) {
            const chatWindow = document.getElementById('chat-window');
            chatWindow.innerHTML = ''; // Clear existing messages
            const messages = data.split('\n');
            messages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                if (message.startsWith(user)) {
                    messageElement.classList.add('client-message');
                } else {
                    messageElement.classList.add('server-message');
                }
                messageElement.textContent = message;
                chatWindow.appendChild(messageElement);
            });
        }

        // Replace 'yourCompany' with the actual company name or identifier
        //const company = 'yourCompany';
        //alert(does);
        //fetchMessages(elem);</script>
</body>
</html>
